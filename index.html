<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>주머니 상점 정보</title>
    <style>
        body { font-family: Arial, sans-serif; }
        .location { font-size: 20px; font-weight: bold; margin-top: 20px; }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; }
        th, td { border: 1px solid #ccc; padding: 10px; text-align: center; }
        .color-box { width: 30px; height: 30px; display: inline-block; margin-right: 5px; }
        .link { margin-left: 10px; font-size: 14px; }
        .link {
            display: inline-block; 
            padding: 10px 20px; 
            background-color: #79cfe7; /* 버튼 배경색 */
            color: white; /* 텍스트 색상 */
            text-align: center; 
            text-decoration: none; /* 밑줄 제거 */
            border-radius: 5px; /* 둥근 모서리 */
            transition: background-color 0.3s; /* 배경색 변화 효과 */
        }
        .link:hover {
            background-color: #ffffa8; /* 호버 시 배경색 변화 */
            color: #1a1b23;
        }
        p { color: gray; }
    </style>
</head>
<body>
    <h1>주머니 상점 정보 
        <a class="link" href="https://openapi.nexon.com/ko/my-application/" target="_blank">API 키 생성하러가기 click!</a>
    </h1>
    <p>API 키는 애플리케이션 등록하기 눌러서 원하는 이름으로 만든 후, 그 이름 클릭해서 들어가서 첫번째 API Key 복사해오시면 됩니다<br>
    0시에 바로 검색하면 오류나니까 좀 여유를 두고 검색하세요</p>

    <!-- 서버 선택 및 채널 입력 -->
    <label for="serverSelect">서버 선택:</label>
    <select id="serverSelect">
        <option value="류트" selected>류트</option>
        <option value="만돌린">만돌린</option>
        <option value="하프">하프</option>
        <option value="울프">울프</option>
    </select>

    <label for="channelInput">채널 번호:</label>
    <input type="text" id="channelInput" placeholder="채널 번호를 입력하세요" value="1" />

    <label for="apiKeyInput">API 키:</label>
    <input type="text" id="apiKeyInput" placeholder="API 키를 입력하세요" value="" />  <!-- 초기값 설정 -->

    <button id="fetchButton">검색</button> <p id="next_time"></p>

    <div id="content"></div>

    <script src="script.js"></script>  <!-- JavaScript 파일 연결 -->
    <script>
        // 페이지가 로드될 때 실행
        window.onload = function() {
            // 로컬 스토리지에서 API 키 가져오기
            const storedApiKey = localStorage.getItem('apiKey');
            if (storedApiKey) {
                document.getElementById('apiKeyInput').value = storedApiKey; // 가져온 키를 입력 필드에 설정
            }

            // 로컬 스토리지에서 서버 및 채널 값 가져오기
            const storedServer = localStorage.getItem('server');
            const storedChannel = localStorage.getItem('channel');
            if (storedServer) {
                document.getElementById('serverSelect').value = storedServer; // 서버 선택 설정
            }
            if (storedChannel) {
                document.getElementById('channelInput').value = storedChannel; // 채널 입력 설정
            }
        };

        // API 키 입력 필드에 이벤트 리스너 추가
        document.getElementById('apiKeyInput').addEventListener('input', function() {
            const apiKey = this.value; // 입력값 가져오기
            localStorage.setItem('apiKey', apiKey); // 로컬 스토리지에 저장
        });

        // 서버 선택 필드에 이벤트 리스너 추가
        document.getElementById('serverSelect').addEventListener('change', function() {
            const server = this.value; // 선택한 서버 가져오기
            localStorage.setItem('server', server); // 로컬 스토리지에 저장
        });

        // 채널 입력 필드에 이벤트 리스너 추가
        document.getElementById('channelInput').addEventListener('input', function() {
            const channel = this.value; // 입력값 가져오기
            localStorage.setItem('channel', channel); // 로컬 스토리지에 저장
        });
    </script>
    <script>
        function updateNextResetTime() {
            const currentTime = new Date();
            const totalMinutesInDay = 24 * 60; // 24시간을 분으로 변환
            const intervalMinutes = 36; // 초기화 간격 36분

            // 36분으로 나눈 시간 조각의 수
            const totalIntervals = totalMinutesInDay / intervalMinutes;

            // 현재 시간을 분으로 변환
            const currentMinutes = currentTime.getHours() * 60 + currentTime.getMinutes();

            // 현재 간격
            const currentInterval = Math.floor(currentMinutes / intervalMinutes);
            const nextInterval = (currentInterval + 1) % totalIntervals;

            // 다음 초기화 시간 계산
            const nextResetMinutes = nextInterval * intervalMinutes;
            const nextResetHours = Math.floor(nextResetMinutes / 60);
            const nextResetMinutesRemainder = nextResetMinutes % 60;

            const nextResetTime = new Date();
            nextResetTime.setHours(nextResetHours, nextResetMinutesRemainder, 0, 0);

            // 남은 시간 계산
            const timeRemaining = nextResetTime - currentTime;

            // 초 단위로 업데이트
            const secondsRemaining = Math.ceil(timeRemaining / 1000);

            // 결과를 표시
            document.getElementById("next_time").innerText = `다음 초기화 시간: ${nextResetTime.toLocaleTimeString()} (남은 시간: ${secondsRemaining}초)`;
        }

        // 매 초마다 업데이트
        setInterval(updateNextResetTime, 1000);

        // 초기화 시 즉시 업데이트
        updateNextResetTime();
    </script>
</body>
</html>
